# VisualSnapAssist (v4)

**VisualSnapAssist (VSA)** は、Blenderの3Dビューポートに「幾何学的拘束ソルバー」と「CADライクなスナップ」をもたらすツールです。主に `Interactive Empty Dropper` 内で動作し、超精密な配置を支援します。

## コア概念: "Source Pick"（始点指定）

Blenderの標準スナップと異なり、VSAはまず「どの部分（コンテキスト）」を基準にするかを修飾キーで決定します。

*   **Ctrl**: 頂点モード（シアン）
*   **Shift**: 辺モード（マゼンタ）
*   **Alt**: ボリュームモード（青/ティール）

## モード解説

### 1. Circle Snap (3点円弧スナップ) - `C` キー
3点を指定して仮想的な円を定義し、その「中心」にスナップします。

1.  `C` キーを押してサークルモードに入ります。
2.  メッシュ上の **任意の3点** をクリックします。
3.  3点が決まると、自動的に **円の中心** が計算され、プレビュー円が表示されます。
4.  左クリックで計算された中心位置にEmptyを配置します。

> [!TIP]
> 壊れた円柱ジオメトリや、頂点が存在しない空間の中心を求めるときに最適です。

!!! note "Deep Dive: Assit Mode Logic"
    これは「3次元空間上の三辺測量」と言えます。2つの回転軸から一定の距離にある結合点を特定する場合、2つの仮想円（Virtual Circle）を描くだけで、その交点に精度良くスナップできます。

### 2. Rotation Snap (回転スナップ) - `R` キー
ピボット・始点・終点を指定して、ドリフト（誤差）のない正確な回転を行います。

**操作フロー:**
1.  `R` キーを押して回転モードに入ります。
2.  **Step 1: Pick Pivot (中心)**: 回転の軸となる点をクリック。
3.  **Step 2: Pick Start (取っ手)**: 動かしたい点（ハンドル）をクリック。
4.  **Step 3: Pick End (ターゲット)**: 目標地点を指定します。
    *   **Intersection Snap (交差)**: 回転軌道が面や辺と交差する場合、自動的にその「交点」にスナップします（オレンジ色のドット）。
    *   **Tangent Snap (接線)**: `T` キーで接線モードに切り替え。ターゲットに対して「接線」となる角度でスナップします。

> [!TIP]
> **接線スナップ (Tangent Snap) の活用**: プーリーにベルトを掛ける際や、カム機構の設計において、円の中心と外部の点から「最も滑らかに繋がる点」を算出します。

### 3. Edge Loop / Ring Logic (ボリュームスナップ)
物体の「内部」や「構造的中心」を取得するための機能です。
`Alt` キー（ボリュームモード）を押しながら `Ctrl` (Loop) または `Shift` (Ring) を使用中：

1.  **Opposite Snap (Altのみ)**: 表面のヒット位置と、その裏面（レイが抜ける位置）の中点を計算します（板厚の中心）。
2.  **Edge Loop Center (Alt + Ctrl)**: パイプや円柱の断面中心を一発で取得します。
3.  **Edge Ring Center (Alt + Shift)**: 蛇腹構造やタイヤのトレッド面の中心などを取得します。

*   **Logic Switching (ロジック切替)**: `Alt` を押したまま **マウスホイール** を回すと、中心計算のロジックが切り替わります。
    *   **Smart**: 角度と面積を考慮した加重平均（デフォルト）。最も自然な中心。
    *   **Linear**: 単純平均。
    *   **Topology**: トポロジー（クアッドフロー）を優先した計算。

## 色によるフィードバック
*   **シアン (Cyan)**: 頂点 (Vertex)
*   **マゼンタ (Magenta)**: 辺の中点 (Edge Mid)
*   **青 (Blue)**: ボリュームスナップ (Volume)

## コマンドリファレンス

### Main Panel (Rig Mechanist タブ)

*   **Start Visual Snap**: ツールを起動し、インタラクティブ操作を開始します。
    *   *アイコン*: `RESTRICT_SELECT_OFF`
    *   *オペレーター*: `vsa.visual_snap`
